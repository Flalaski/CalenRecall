<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Import Progress - CalenRecall</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
      background: #1e1e1e;
      color: #e0e0e0;
      padding: 40px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      user-select: none;
    }

    .progress-container {
      width: 100%;
      max-width: 600px;
      background: #2d2d2d;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      border: 1px solid #404040;
    }

    h2 {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 8px;
      color: #ffffff;
      text-align: center;
    }

    .subtitle {
      font-size: 14px;
      color: #a0a0a0;
      text-align: center;
      margin-bottom: 30px;
    }

    .progress-bar-container {
      width: 100%;
      height: 32px;
      background: #1a1a1a;
      border-radius: 16px;
      overflow: hidden;
      margin-bottom: 20px;
      border: 1px solid #404040;
      position: relative;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #4CAF50 0%, #45a049 100%);
      border-radius: 16px;
      transition: width 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .progress-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
      background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 255, 255, 0.2),
        transparent
      );
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% {
        transform: translateX(-100%);
      }
      100% {
        transform: translateX(100%);
      }
    }

    .progress-percentage {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 14px;
      font-weight: 600;
      color: #ffffff;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
      z-index: 1;
    }

    .message {
      font-size: 15px;
      color: #e0e0e0;
      text-align: center;
      margin-bottom: 20px;
      min-height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      line-height: 1.5;
    }

    .stats {
      display: flex;
      justify-content: space-around;
      gap: 20px;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid #404040;
    }

    .stat {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }

    .stat-value {
      font-size: 24px;
      font-weight: 600;
      color: #4CAF50;
    }

    .stat-label {
      font-size: 12px;
      color: #a0a0a0;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .error {
      color: #f44336;
      background: rgba(244, 67, 54, 0.1);
      padding: 16px;
      border-radius: 8px;
      border: 1px solid rgba(244, 67, 54, 0.3);
      margin-top: 20px;
      text-align: center;
    }

    .success {
      color: #4CAF50;
      background: rgba(76, 175, 80, 0.1);
      padding: 16px;
      border-radius: 8px;
      border: 1px solid rgba(76, 175, 80, 0.3);
      margin-top: 20px;
      text-align: center;
      font-weight: 500;
    }

    .stage-indicator {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 20px;
    }

    .stage-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #404040;
      transition: background 0.3s ease;
    }

    .stage-dot.active {
      background: #4CAF50;
      box-shadow: 0 0 8px rgba(76, 175, 80, 0.5);
    }

    .stage-dot.complete {
      background: #4CAF50;
    }

    .close-button {
      margin-top: 30px;
      padding: 12px 32px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s ease;
      display: none;
    }

    .close-button:hover {
      background: #45a049;
    }

    .close-button.show {
      display: block;
    }

    .loading-spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid #404040;
      border-top-color: #4CAF50;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-right: 8px;
      vertical-align: middle;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .stage-name {
      font-size: 12px;
      color: #a0a0a0;
      text-align: center;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
  </style>
</head>
<body>
  <div class="progress-container">
    <h2>Importing Entries</h2>
    <div class="subtitle">Please wait while entries are being imported...</div>

    <div class="stage-indicator">
      <div class="stage-dot" id="stage-reading"></div>
      <div class="stage-dot" id="stage-parsing"></div>
      <div class="stage-dot" id="stage-importing"></div>
      <div class="stage-dot" id="stage-complete"></div>
    </div>

    <div class="stage-name" id="stage-name">Reading file...</div>

    <div class="progress-bar-container">
      <div class="progress-bar" id="progress-bar" style="width: 0%">
        <div class="progress-percentage" id="progress-percentage">0%</div>
      </div>
    </div>

    <div class="message" id="message">Preparing import...</div>

    <div class="stats" id="stats" style="display: none;">
      <div class="stat">
        <div class="stat-value" id="imported-count">0</div>
        <div class="stat-label">Imported</div>
      </div>
      <div class="stat">
        <div class="stat-value" id="skipped-count">0</div>
        <div class="stat-label">Skipped</div>
      </div>
      <div class="stat">
        <div class="stat-value" id="total-count">0</div>
        <div class="stat-label">Total</div>
      </div>
    </div>

    <div id="status-message"></div>

    <button class="close-button" id="close-button" onclick="window.close()">Close</button>
  </div>

  <script>
    const progressBar = document.getElementById('progress-bar');
    const progressPercentage = document.getElementById('progress-percentage');
    const message = document.getElementById('message');
    const statusMessage = document.getElementById('status-message');
    const closeButton = document.getElementById('close-button');
    const stats = document.getElementById('stats');
    const importedCount = document.getElementById('imported-count');
    const skippedCount = document.getElementById('skipped-count');
    const totalCount = document.getElementById('total-count');
    const stageName = document.getElementById('stage-name');

    // Stage indicators
    const stages = {
      reading: document.getElementById('stage-reading'),
      parsing: document.getElementById('stage-parsing'),
      importing: document.getElementById('stage-importing'),
      complete: document.getElementById('stage-complete'),
    };

    let currentStage = null;

    function updateStage(stage) {
      if (currentStage) {
        stages[currentStage]?.classList.remove('active');
        stages[currentStage]?.classList.add('complete');
      }
      
      if (stage && stages[stage]) {
        stages[stage].classList.add('active');
        currentStage = stage;
      }

      // Update stage name
      const stageNames = {
        reading: 'Reading File',
        parsing: 'Parsing Entries',
        importing: 'Importing Entries',
        complete: 'Complete',
        error: 'Error',
      };
      stageName.textContent = stageNames[stage] || '';
    }

    function updateProgress(data) {
      const { stage, progress, message: msg, total, imported, skipped } = data;

      // Update progress bar
      const progressValue = Math.max(0, Math.min(100, progress || 0));
      progressBar.style.width = `${progressValue}%`;
      progressPercentage.textContent = `${Math.round(progressValue)}%`;

      // Update message
      if (msg) {
        message.innerHTML = msg;
      }

      // Update stage
      if (stage) {
        updateStage(stage);
      }

      // Update stats
      if (total !== undefined) {
        stats.style.display = 'flex';
        totalCount.textContent = total.toLocaleString();
        
        if (imported !== undefined) {
          importedCount.textContent = imported.toLocaleString();
        }
        
        if (skipped !== undefined) {
          skippedCount.textContent = skipped.toLocaleString();
          if (skipped > 0) {
            skippedCount.style.color = '#ff9800';
          } else {
            skippedCount.style.color = '#4CAF50';
          }
        }
      }

      // Handle completion
      if (stage === 'complete') {
        statusMessage.innerHTML = `
          <div class="success">
            ✓ Import completed successfully!
          </div>
        `;
        updateStage('complete');
        closeButton.classList.add('show');
        // Auto-close after 3 seconds
        setTimeout(() => {
          if (window.electronAPI && window.electronAPI.closeImportProgress) {
            window.electronAPI.closeImportProgress();
          } else {
            window.close();
          }
        }, 3000);
      }

      // Handle errors
      if (stage === 'error') {
        statusMessage.innerHTML = `
          <div class="error">
            ✗ ${msg || 'Import failed'}
          </div>
        `;
        closeButton.classList.add('show');
        progressBar.style.background = '#f44336';
      }
    }

    // Listen for progress updates from main process
    if (window.electronAPI && window.electronAPI.onImportProgress) {
      window.electronAPI.onImportProgress((progress) => {
        updateProgress(progress);
      });
    }

    // Initialize
    updateStage('reading');
    updateProgress({ progress: 0, message: 'Preparing import...' });

    // Prevent window close during import (unless explicitly allowed)
    window.addEventListener('beforeunload', (e) => {
      if (currentStage !== 'complete' && currentStage !== 'error') {
        e.preventDefault();
        e.returnValue = '';
        return '';
      }
    });
  </script>
</body>
</html>

